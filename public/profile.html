<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Profile - Utility Tools</title>
  <link href="output.css" rel="stylesheet">
  <!-- Flag Icons CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css">
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" href="https://api.iconify.design/mdi/timer-outline.svg?color=%234f46e5&width=32&height=32">
  <link rel="apple-touch-icon" href="https://api.iconify.design/mdi/timer-outline.svg?color=%234f46e5&width=180&height=180">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <!-- Custom styles -->
  <style>
    /* Improve date input appearance with calendar icon */
    input[type="date"] {
      position: relative;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 20px;
      padding-right: 40px;
    }
    
    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      background-color: #10b981;
    }
    
    .toast.error {
      background-color: #ef4444;
    }
    
    .toast.info {
      background-color: #3b82f6;
    }
    
    .toast.warning {
      background-color: #f59e0b;
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
  <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <a href="/" class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
              <span class="text-white font-bold text-sm">UT</span>
            </div>
            <span class="text-xl font-bold text-gray-800 dark:text-gray-200">Utility Tools</span>
          </a>
        </div>
        
        <div class="flex items-center space-x-4">
          <!-- User Profile Dropdown -->
          <div class="relative" id="userProfileSection" style="display: none;">
            <button id="profileButton" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
              <div class="w-8 h-8 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
                <span id="userInitials" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400">SP</span>
              </div>
              <span id="userName" class="hidden sm:block">Sachin Patel</span>
            </button>
          </div>
          
          <!-- Login Button -->
          <button id="loginButton" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
            Sign In
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Profile Header -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-200">ğŸ‘¤ My Profile</h1>
        <a href="/" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 transition">
          â† Back to Tools
        </a>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Profile Info Card -->
        <div class="lg:col-span-1">
          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 text-center">
            <div class="w-24 h-24 mx-auto mb-4 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
              <span id="profileInitials" class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">SP</span>
            </div>
            <h3 id="profileName" class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">Sachin Patel</h3>
            <p id="profileEmail" class="text-gray-600 dark:text-gray-400 mb-4">sachinrkp07@gmail.com</p>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-500 dark:text-gray-400">Country:</span>
                <span id="profileCountry" class="text-gray-800 dark:text-gray-200">United States</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500 dark:text-gray-400">Timezone:</span>
                <span id="profileTimezone" class="text-gray-800 dark:text-gray-200">UTC</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500 dark:text-gray-400">Member Since:</span>
                <span id="profileJoinDate" class="text-gray-800 dark:text-gray-200">Dec 2024</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Actions -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Personal Information -->
          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Personal Information</h4>
            <form id="profileForm" class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="editName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Name</label>
                  <input type="text" id="editName" 
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                </div>
                <div>
                  <label for="editEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                  <input type="email" id="editEmail" readonly
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed">
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="editCountry" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Country</label>
                  <select id="editCountry" 
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                    <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
                    <option value="IN">ğŸ‡®ğŸ‡³ India</option>
                    <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                    <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
                    <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
                    <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
                    <option value="FR">ğŸ‡«ğŸ‡· France</option>
                    <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                    <option value="CN">ğŸ‡¨ğŸ‡³ China</option>
                    <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
                  </select>
                </div>
                <div>
                  <label for="editTimezone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Timezone</label>
                  <select id="editTimezone" 
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                    <option value="UTC">UTC</option>
                    <option value="America/New_York">America/New_York</option>
                    <option value="America/Chicago">America/Chicago</option>
                    <option value="America/Denver">America/Denver</option>
                    <option value="America/Los_Angeles">America/Los_Angeles</option>
                    <option value="Europe/London">Europe/London</option>
                    <option value="Europe/Paris">Europe/Paris</option>
                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                    <option value="Asia/Kolkata">Asia/Kolkata</option>
                    <option value="Australia/Sydney">Australia/Sydney</option>
                  </select>
                </div>
              </div>
              <div class="flex justify-end">
                <button type="submit" 
                  class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition">
                  Save Changes
                </button>
              </div>
            </form>
          </div>

          <!-- Security Settings -->
          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Security Settings</h4>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg">
                <div>
                  <h5 class="font-medium text-gray-800 dark:text-gray-200">Password</h5>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Last changed: Never</p>
                </div>
                <button id="resetPasswordBtn" 
                  class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition text-sm">
                  Reset Password
                </button>
              </div>
              <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg">
                <div>
                  <h5 class="font-medium text-gray-800 dark:text-gray-200">Two-Factor Authentication</h5>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Add an extra layer of security</p>
                </div>
                <button class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition text-sm">
                  Enable 2FA
                </button>
              </div>
            </div>
          </div>

          <!-- Account Actions -->
          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Account Actions</h4>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg">
                <div>
                  <h5 class="font-medium text-gray-800 dark:text-gray-200">Export Data</h5>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Download your personal data</p>
                </div>
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition text-sm">
                  Export
                </button>
              </div>
              <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 rounded-lg">
                <div>
                  <h5 class="font-medium text-gray-800 dark:text-gray-200">Delete Account</h5>
                  <p class="text-sm text-gray-600 dark:text-gray-400">Permanently delete your account</p>
                </div>
                <button id="deleteAccountBtn" 
                  class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition text-sm">
                  Delete Account
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- Scripts -->
  <script src="script.js"></script>
  <script>
    // Profile page specific functionality
    class ProfilePage {
      constructor() {
        this.currentUser = null;
        this.authToken = null;
        this.initializeAuth();
        this.setupEventListeners();
      }

      async initializeAuth() {
        // Check if user is authenticated
        if (typeof firebase !== 'undefined') {
          // Initialize Firebase first
          try {
            const configResponse = await fetch('/api/config');
            const config = await configResponse.json();
            
            const firebaseConfig = {
              apiKey: config.firebaseApiKey || "AIzaSyC9UxLaYTPW...",
              authDomain: config.firebaseAuthDomain || "utility-tools-12345.firebaseapp.com",
              projectId: config.firebaseProjectId || "utility-tools-12345",
              storageBucket: config.firebaseStorageBucket || "utility-tools-12345.appspot.com",
              messagingSenderId: config.firebaseMessagingSenderId || "123456789",
              appId: config.firebaseAppId || "1:123456789:web:abcdef123456"
            };

            if (firebaseConfig.apiKey && firebaseConfig.projectId) {
              firebase.initializeApp(firebaseConfig);
            }
          } catch (error) {
            console.error('Firebase config error:', error);
          }

          firebase.auth().onAuthStateChanged((user) => {
            if (user) {
              this.currentUser = user;
              this.loadUserProfile();
              this.updateUI();
            } else {
              // Redirect to login if not authenticated
              window.location.href = '/';
            }
          });
        } else {
          // Redirect to login if Firebase not loaded
          window.location.href = '/';
        }
      }

      loadUserProfile() {
        if (this.currentUser) {
          // Update profile display
          document.getElementById('profileName').textContent = this.currentUser.displayName || 'User';
          document.getElementById('profileEmail').textContent = this.currentUser.email;
          document.getElementById('profileInitials').textContent = this.getInitials(this.currentUser.displayName || this.currentUser.email);
          
          // Update form fields
          document.getElementById('editName').value = this.currentUser.displayName || '';
          document.getElementById('editEmail').value = this.currentUser.email;
          
          // Load additional user data from localStorage or backend
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          document.getElementById('profileCountry').textContent = userData.country || 'United States';
          document.getElementById('profileTimezone').textContent = userData.timezone || 'UTC';
          
          // Update Member Since date
          const joinDate = userData.createdAt || this.currentUser.metadata?.creationTime || new Date().toISOString();
          const date = new Date(joinDate);
          const month = date.toLocaleDateString('en-US', { month: 'short' });
          const year = date.getFullYear();
          document.getElementById('profileJoinDate').textContent = `${month} ${year}`;
          document.getElementById('editCountry').value = userData.countryCode || 'US';
          document.getElementById('editTimezone').value = userData.timezone || 'UTC';
        }
      }

      getInitials(name) {
        if (!name) return 'U';
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
      }

      updateUI() {
        const userProfileSection = document.getElementById('userProfileSection');
        const loginButton = document.getElementById('loginButton');
        
        if (this.currentUser) {
          userProfileSection.style.display = 'block';
          loginButton.style.display = 'none';
          
          document.getElementById('userName').textContent = this.currentUser.displayName || 'User';
          document.getElementById('userInitials').textContent = this.getInitials(this.currentUser.displayName || this.currentUser.email);
        } else {
          userProfileSection.style.display = 'none';
          loginButton.style.display = 'block';
        }
      }

      setupEventListeners() {
        // Profile form submission
        document.getElementById('profileForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.updateProfile();
        });

        // Password reset
        document.getElementById('resetPasswordBtn').addEventListener('click', () => {
          this.resetPassword();
        });

        // Delete account
        document.getElementById('deleteAccountBtn').addEventListener('click', () => {
          this.deleteAccount();
        });
      }

      async updateProfile() {
        const name = document.getElementById('editName').value;
        const country = document.getElementById('editCountry').value;
        const timezone = document.getElementById('editTimezone').value;

        try {
          // Update Firebase profile
          await this.currentUser.updateProfile({
            displayName: name
          });

          // Save additional data to localStorage
          const userData = {
            country: document.getElementById('editCountry').selectedOptions[0].text,
            countryCode: country,
            timezone: timezone
          };
          localStorage.setItem('userData', JSON.stringify(userData));

          // Update display
          this.loadUserProfile();
          this.showToast('Profile updated successfully!', 'success');
        } catch (error) {
          console.error('Profile update error:', error);
          this.showToast('Failed to update profile', 'error');
        }
      }

      async resetPassword() {
        try {
          await firebase.auth().sendPasswordResetEmail(this.currentUser.email);
          this.showToast('Password reset email sent!', 'success');
        } catch (error) {
          console.error('Password reset error:', error);
          this.showToast('Failed to send password reset email', 'error');
        }
      }

      async deleteAccount() {
        if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
          try {
            await this.currentUser.delete();
            localStorage.removeItem('userData');
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            this.showToast('Account deleted successfully', 'success');
            setTimeout(() => {
              window.location.href = '/';
            }, 2000);
          } catch (error) {
            console.error('Account deletion error:', error);
            this.showToast('Failed to delete account', 'error');
          }
        }
      }

      showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        document.getElementById('toastContainer').appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
    }

    // Initialize profile page when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new ProfilePage();
    });
  </script>
</body>

</html>
